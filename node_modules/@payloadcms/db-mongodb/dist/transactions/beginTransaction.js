"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "beginTransaction", {
    enumerable: true,
    get: function() {
        return beginTransaction;
    }
});
const _errors = require("payload/errors");
const _uuid = require("uuid");
const beginTransaction = async function beginTransaction(options) {
    if (!this.connection) {
        throw new _errors.APIError('beginTransaction called while no connection to the database exists');
    }
    const client = this.connection.getClient();
    const id = (0, _uuid.v4)();
    if (!this.sessions[id]) {
        this.sessions[id] = client.startSession();
    }
    if (this.sessions[id].inTransaction()) {
        this.payload.logger.warn('beginTransaction called while transaction already exists');
    } else {
        this.sessions[id].startTransaction(options || this.transactionOptions);
    }
    return id;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90cmFuc2FjdGlvbnMvYmVnaW5UcmFuc2FjdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IFRyYW5zYWN0aW9uT3B0aW9ucyB9IGZyb20gJ21vbmdvZGInXG5pbXBvcnQgdHlwZSB7IEJlZ2luVHJhbnNhY3Rpb24gfSBmcm9tICdwYXlsb2FkL2RhdGFiYXNlJ1xuXG5pbXBvcnQgeyBBUElFcnJvciB9IGZyb20gJ3BheWxvYWQvZXJyb3JzJ1xuaW1wb3J0IHsgdjQgYXMgdXVpZCB9IGZyb20gJ3V1aWQnXG5cbmltcG9ydCB0eXBlIHsgTW9uZ29vc2VBZGFwdGVyIH0gZnJvbSAnLi4vaW5kZXgnXG5cbmV4cG9ydCBjb25zdCBiZWdpblRyYW5zYWN0aW9uOiBCZWdpblRyYW5zYWN0aW9uID0gYXN5bmMgZnVuY3Rpb24gYmVnaW5UcmFuc2FjdGlvbihcbiAgdGhpczogTW9uZ29vc2VBZGFwdGVyLFxuICBvcHRpb25zOiBUcmFuc2FjdGlvbk9wdGlvbnMsXG4pIHtcbiAgaWYgKCF0aGlzLmNvbm5lY3Rpb24pIHtcbiAgICB0aHJvdyBuZXcgQVBJRXJyb3IoJ2JlZ2luVHJhbnNhY3Rpb24gY2FsbGVkIHdoaWxlIG5vIGNvbm5lY3Rpb24gdG8gdGhlIGRhdGFiYXNlIGV4aXN0cycpXG4gIH1cblxuICBjb25zdCBjbGllbnQgPSB0aGlzLmNvbm5lY3Rpb24uZ2V0Q2xpZW50KClcbiAgY29uc3QgaWQgPSB1dWlkKClcblxuICBpZiAoIXRoaXMuc2Vzc2lvbnNbaWRdKSB7XG4gICAgdGhpcy5zZXNzaW9uc1tpZF0gPSBjbGllbnQuc3RhcnRTZXNzaW9uKClcbiAgfVxuICBpZiAodGhpcy5zZXNzaW9uc1tpZF0uaW5UcmFuc2FjdGlvbigpKSB7XG4gICAgdGhpcy5wYXlsb2FkLmxvZ2dlci53YXJuKCdiZWdpblRyYW5zYWN0aW9uIGNhbGxlZCB3aGlsZSB0cmFuc2FjdGlvbiBhbHJlYWR5IGV4aXN0cycpXG4gIH0gZWxzZSB7XG4gICAgdGhpcy5zZXNzaW9uc1tpZF0uc3RhcnRUcmFuc2FjdGlvbihvcHRpb25zIHx8ICh0aGlzLnRyYW5zYWN0aW9uT3B0aW9ucyBhcyBUcmFuc2FjdGlvbk9wdGlvbnMpKVxuICB9XG5cbiAgcmV0dXJuIGlkXG59XG4iXSwibmFtZXMiOlsiYmVnaW5UcmFuc2FjdGlvbiIsIm9wdGlvbnMiLCJjb25uZWN0aW9uIiwiQVBJRXJyb3IiLCJjbGllbnQiLCJnZXRDbGllbnQiLCJpZCIsInV1aWQiLCJzZXNzaW9ucyIsInN0YXJ0U2Vzc2lvbiIsImluVHJhbnNhY3Rpb24iLCJwYXlsb2FkIiwibG9nZ2VyIiwid2FybiIsInN0YXJ0VHJhbnNhY3Rpb24iLCJ0cmFuc2FjdGlvbk9wdGlvbnMiXSwicmFuZ2VNYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OyIsIm1hcHBpbmdzIjoiOzs7OytCQVFhQTs7O2VBQUFBOzs7d0JBTFk7c0JBQ0U7QUFJcEIsTUFBTUEsbUJBQXFDLGVBQWVBLGlCQUUvREMsT0FBMkI7SUFFM0IsSUFBSSxDQUFDLElBQUksQ0FBQ0MsVUFBVSxFQUFFO1FBQ3BCLE1BQU0sSUFBSUMsZ0JBQVEsQ0FBQztJQUNyQjtJQUVBLE1BQU1DLFNBQVMsSUFBSSxDQUFDRixVQUFVLENBQUNHLFNBQVM7SUFDeEMsTUFBTUMsS0FBS0MsSUFBQUEsUUFBSTtJQUVmLElBQUksQ0FBQyxJQUFJLENBQUNDLFFBQVEsQ0FBQ0YsR0FBRyxFQUFFO1FBQ3RCLElBQUksQ0FBQ0UsUUFBUSxDQUFDRixHQUFHLEdBQUdGLE9BQU9LLFlBQVk7SUFDekM7SUFDQSxJQUFJLElBQUksQ0FBQ0QsUUFBUSxDQUFDRixHQUFHLENBQUNJLGFBQWEsSUFBSTtRQUNyQyxJQUFJLENBQUNDLE9BQU8sQ0FBQ0MsTUFBTSxDQUFDQyxJQUFJLENBQUM7SUFDM0IsT0FBTztRQUNMLElBQUksQ0FBQ0wsUUFBUSxDQUFDRixHQUFHLENBQUNRLGdCQUFnQixDQUFDYixXQUFZLElBQUksQ0FBQ2Msa0JBQWtCO0lBQ3hFO0lBRUEsT0FBT1Q7QUFDVCJ9