"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "create", {
    enumerable: true,
    get: function() {
        return create;
    }
});
const _handleError = /*#__PURE__*/ _interop_require_default(require("./utilities/handleError"));
const _sanitizeInternalFields = /*#__PURE__*/ _interop_require_default(require("./utilities/sanitizeInternalFields"));
const _withSession = require("./withSession");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const create = async function create({ collection, data, req = {} }) {
    const Model = this.collections[collection];
    const options = await (0, _withSession.withSession)(this, req);
    let doc;
    try {
        [doc] = await Model.create([
            data
        ], options);
    } catch (error) {
        (0, _handleError.default)(error, req);
    }
    const result = this.jsonParse ? JSON.parse(JSON.stringify(doc)) : doc.toObject();
    const verificationToken = doc._verificationToken;
    if (verificationToken) {
        result._verificationToken = verificationToken;
    }
    return (0, _sanitizeInternalFields.default)(result);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jcmVhdGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDcmVhdGUgfSBmcm9tICdwYXlsb2FkL2RhdGFiYXNlJ1xuaW1wb3J0IHR5cGUgeyBQYXlsb2FkUmVxdWVzdCB9IGZyb20gJ3BheWxvYWQvdHlwZXMnXG5cbmltcG9ydCB0eXBlIHsgTW9uZ29vc2VBZGFwdGVyIH0gZnJvbSAnLidcblxuaW1wb3J0IGhhbmRsZUVycm9yIGZyb20gJy4vdXRpbGl0aWVzL2hhbmRsZUVycm9yJ1xuaW1wb3J0IHNhbml0aXplSW50ZXJuYWxGaWVsZHMgZnJvbSAnLi91dGlsaXRpZXMvc2FuaXRpemVJbnRlcm5hbEZpZWxkcydcbmltcG9ydCB7IHdpdGhTZXNzaW9uIH0gZnJvbSAnLi93aXRoU2Vzc2lvbidcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZTogQ3JlYXRlID0gYXN5bmMgZnVuY3Rpb24gY3JlYXRlKFxuICB0aGlzOiBNb25nb29zZUFkYXB0ZXIsXG4gIHsgY29sbGVjdGlvbiwgZGF0YSwgcmVxID0ge30gYXMgUGF5bG9hZFJlcXVlc3QgfSxcbikge1xuICBjb25zdCBNb2RlbCA9IHRoaXMuY29sbGVjdGlvbnNbY29sbGVjdGlvbl1cbiAgY29uc3Qgb3B0aW9ucyA9IGF3YWl0IHdpdGhTZXNzaW9uKHRoaXMsIHJlcSlcbiAgbGV0IGRvY1xuICB0cnkge1xuICAgIDtbZG9jXSA9IGF3YWl0IE1vZGVsLmNyZWF0ZShbZGF0YV0sIG9wdGlvbnMpXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaGFuZGxlRXJyb3IoZXJyb3IsIHJlcSlcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdCA9IHRoaXMuanNvblBhcnNlID8gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkb2MpKSA6IGRvYy50b09iamVjdCgpXG5cbiAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW4gPSBkb2MuX3ZlcmlmaWNhdGlvblRva2VuXG5cbiAgaWYgKHZlcmlmaWNhdGlvblRva2VuKSB7XG4gICAgcmVzdWx0Ll92ZXJpZmljYXRpb25Ub2tlbiA9IHZlcmlmaWNhdGlvblRva2VuXG4gIH1cblxuICByZXR1cm4gc2FuaXRpemVJbnRlcm5hbEZpZWxkcyhyZXN1bHQpXG59XG4iXSwibmFtZXMiOlsiY3JlYXRlIiwiY29sbGVjdGlvbiIsImRhdGEiLCJyZXEiLCJNb2RlbCIsImNvbGxlY3Rpb25zIiwib3B0aW9ucyIsIndpdGhTZXNzaW9uIiwiZG9jIiwiZXJyb3IiLCJoYW5kbGVFcnJvciIsInJlc3VsdCIsImpzb25QYXJzZSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsInRvT2JqZWN0IiwidmVyaWZpY2F0aW9uVG9rZW4iLCJfdmVyaWZpY2F0aW9uVG9rZW4iLCJzYW5pdGl6ZUludGVybmFsRmllbGRzIl0sInJhbmdlTWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OyIsIm1hcHBpbmdzIjoiOzs7OytCQVNhQTs7O2VBQUFBOzs7b0VBSlc7K0VBQ1c7NkJBQ1A7Ozs7OztBQUVyQixNQUFNQSxTQUFpQixlQUFlQSxPQUUzQyxFQUFFQyxVQUFVLEVBQUVDLElBQUksRUFBRUMsTUFBTSxDQUFDLENBQW1CLEVBQUU7SUFFaEQsTUFBTUMsUUFBUSxJQUFJLENBQUNDLFdBQVcsQ0FBQ0osV0FBVztJQUMxQyxNQUFNSyxVQUFVLE1BQU1DLElBQUFBLHdCQUFXLEVBQUMsSUFBSSxFQUFFSjtJQUN4QyxJQUFJSztJQUNKLElBQUk7UUFDRCxDQUFDQSxJQUFJLEdBQUcsTUFBTUosTUFBTUosTUFBTSxDQUFDO1lBQUNFO1NBQUssRUFBRUk7SUFDdEMsRUFBRSxPQUFPRyxPQUFPO1FBQ2RDLElBQUFBLG9CQUFXLEVBQUNELE9BQU9OO0lBQ3JCO0lBRUEsTUFBTVEsU0FBUyxJQUFJLENBQUNDLFNBQVMsR0FBR0MsS0FBS0MsS0FBSyxDQUFDRCxLQUFLRSxTQUFTLENBQUNQLFFBQVFBLElBQUlRLFFBQVE7SUFFOUUsTUFBTUMsb0JBQW9CVCxJQUFJVSxrQkFBa0I7SUFFaEQsSUFBSUQsbUJBQW1CO1FBQ3JCTixPQUFPTyxrQkFBa0IsR0FBR0Q7SUFDOUI7SUFFQSxPQUFPRSxJQUFBQSwrQkFBc0IsRUFBQ1I7QUFDaEMifQ==