"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "findOne", {
    enumerable: true,
    get: function() {
        return findOne;
    }
});
const _sanitizeInternalFields = /*#__PURE__*/ _interop_require_default(require("./utilities/sanitizeInternalFields"));
const _withSession = require("./withSession");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const findOne = async function findOne({ collection, locale, req = {}, where }) {
    const Model = this.collections[collection];
    const options = {
        ...await (0, _withSession.withSession)(this, req),
        lean: true
    };
    const query = await Model.buildQuery({
        locale,
        payload: this.payload,
        where
    });
    let doc = await Model.findOne(query, {}, options);
    if (!doc) {
        return null;
    }
    doc = this.jsonParse ? JSON.parse(JSON.stringify(doc)) : doc;
    doc = (0, _sanitizeInternalFields.default)(doc);
    return doc;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9maW5kT25lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTW9uZ29vc2VRdWVyeU9wdGlvbnMgfSBmcm9tICdtb25nb29zZSdcbmltcG9ydCB0eXBlIHsgRmluZE9uZSB9IGZyb20gJ3BheWxvYWQvZGF0YWJhc2UnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWRSZXF1ZXN0IH0gZnJvbSAncGF5bG9hZC90eXBlcydcblxuaW1wb3J0IHR5cGUgeyBNb25nb29zZUFkYXB0ZXIgfSBmcm9tICcuJ1xuXG5pbXBvcnQgc2FuaXRpemVJbnRlcm5hbEZpZWxkcyBmcm9tICcuL3V0aWxpdGllcy9zYW5pdGl6ZUludGVybmFsRmllbGRzJ1xuaW1wb3J0IHsgd2l0aFNlc3Npb24gfSBmcm9tICcuL3dpdGhTZXNzaW9uJ1xuXG5leHBvcnQgY29uc3QgZmluZE9uZTogRmluZE9uZSA9IGFzeW5jIGZ1bmN0aW9uIGZpbmRPbmUoXG4gIHRoaXM6IE1vbmdvb3NlQWRhcHRlcixcbiAgeyBjb2xsZWN0aW9uLCBsb2NhbGUsIHJlcSA9IHt9IGFzIFBheWxvYWRSZXF1ZXN0LCB3aGVyZSB9LFxuKSB7XG4gIGNvbnN0IE1vZGVsID0gdGhpcy5jb2xsZWN0aW9uc1tjb2xsZWN0aW9uXVxuICBjb25zdCBvcHRpb25zOiBNb25nb29zZVF1ZXJ5T3B0aW9ucyA9IHtcbiAgICAuLi4oYXdhaXQgd2l0aFNlc3Npb24odGhpcywgcmVxKSksXG4gICAgbGVhbjogdHJ1ZSxcbiAgfVxuXG4gIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgTW9kZWwuYnVpbGRRdWVyeSh7XG4gICAgbG9jYWxlLFxuICAgIHBheWxvYWQ6IHRoaXMucGF5bG9hZCxcbiAgICB3aGVyZSxcbiAgfSlcblxuICBsZXQgZG9jID0gYXdhaXQgTW9kZWwuZmluZE9uZShxdWVyeSwge30sIG9wdGlvbnMpXG5cbiAgaWYgKCFkb2MpIHtcbiAgICByZXR1cm4gbnVsbFxuICB9XG5cbiAgZG9jID0gdGhpcy5qc29uUGFyc2UgPyBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRvYykpIDogZG9jXG5cbiAgZG9jID0gc2FuaXRpemVJbnRlcm5hbEZpZWxkcyhkb2MpXG5cbiAgcmV0dXJuIGRvY1xufVxuIl0sIm5hbWVzIjpbImZpbmRPbmUiLCJjb2xsZWN0aW9uIiwibG9jYWxlIiwicmVxIiwid2hlcmUiLCJNb2RlbCIsImNvbGxlY3Rpb25zIiwib3B0aW9ucyIsIndpdGhTZXNzaW9uIiwibGVhbiIsInF1ZXJ5IiwiYnVpbGRRdWVyeSIsInBheWxvYWQiLCJkb2MiLCJqc29uUGFyc2UiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJzYW5pdGl6ZUludGVybmFsRmllbGRzIl0sInJhbmdlTWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OyIsIm1hcHBpbmdzIjoiOzs7OytCQVNhQTs7O2VBQUFBOzs7K0VBSHNCOzZCQUNQOzs7Ozs7QUFFckIsTUFBTUEsVUFBbUIsZUFBZUEsUUFFN0MsRUFBRUMsVUFBVSxFQUFFQyxNQUFNLEVBQUVDLE1BQU0sQ0FBQyxDQUFtQixFQUFFQyxLQUFLLEVBQUU7SUFFekQsTUFBTUMsUUFBUSxJQUFJLENBQUNDLFdBQVcsQ0FBQ0wsV0FBVztJQUMxQyxNQUFNTSxVQUFnQztRQUNwQyxHQUFJLE1BQU1DLElBQUFBLHdCQUFXLEVBQUMsSUFBSSxFQUFFTCxJQUFJO1FBQ2hDTSxNQUFNO0lBQ1I7SUFFQSxNQUFNQyxRQUFRLE1BQU1MLE1BQU1NLFVBQVUsQ0FBQztRQUNuQ1Q7UUFDQVUsU0FBUyxJQUFJLENBQUNBLE9BQU87UUFDckJSO0lBQ0Y7SUFFQSxJQUFJUyxNQUFNLE1BQU1SLE1BQU1MLE9BQU8sQ0FBQ1UsT0FBTyxDQUFDLEdBQUdIO0lBRXpDLElBQUksQ0FBQ00sS0FBSztRQUNSLE9BQU87SUFDVDtJQUVBQSxNQUFNLElBQUksQ0FBQ0MsU0FBUyxHQUFHQyxLQUFLQyxLQUFLLENBQUNELEtBQUtFLFNBQVMsQ0FBQ0osUUFBUUE7SUFFekRBLE1BQU1LLElBQUFBLCtCQUFzQixFQUFDTDtJQUU3QixPQUFPQTtBQUNUIn0=