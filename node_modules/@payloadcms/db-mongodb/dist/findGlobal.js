"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "findGlobal", {
    enumerable: true,
    get: function() {
        return findGlobal;
    }
});
const _database = require("payload/database");
const _sanitizeInternalFields = /*#__PURE__*/ _interop_require_default(require("./utilities/sanitizeInternalFields"));
const _withSession = require("./withSession");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const findGlobal = async function findGlobal({ slug, locale, req = {}, where }) {
    const Model = this.globals;
    const options = {
        ...await (0, _withSession.withSession)(this, req),
        lean: true
    };
    const query = await Model.buildQuery({
        globalSlug: slug,
        locale,
        payload: this.payload,
        where: (0, _database.combineQueries)({
            globalType: {
                equals: slug
            }
        }, where)
    });
    let doc = await Model.findOne(query, {}, options);
    if (!doc) {
        return null;
    }
    if (this.jsonParse) {
        doc = JSON.parse(JSON.stringify(doc));
    }
    if (doc._id) {
        doc.id = JSON.parse(JSON.stringify(doc._id));
        delete doc._id;
    }
    doc = (0, _sanitizeInternalFields.default)(doc);
    return doc;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9maW5kR2xvYmFsLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgRmluZEdsb2JhbCB9IGZyb20gJ3BheWxvYWQvZGF0YWJhc2UnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWRSZXF1ZXN0IH0gZnJvbSAncGF5bG9hZC90eXBlcydcblxuaW1wb3J0IHsgY29tYmluZVF1ZXJpZXMgfSBmcm9tICdwYXlsb2FkL2RhdGFiYXNlJ1xuXG5pbXBvcnQgdHlwZSB7IE1vbmdvb3NlQWRhcHRlciB9IGZyb20gJy4nXG5cbmltcG9ydCBzYW5pdGl6ZUludGVybmFsRmllbGRzIGZyb20gJy4vdXRpbGl0aWVzL3Nhbml0aXplSW50ZXJuYWxGaWVsZHMnXG5pbXBvcnQgeyB3aXRoU2Vzc2lvbiB9IGZyb20gJy4vd2l0aFNlc3Npb24nXG5cbmV4cG9ydCBjb25zdCBmaW5kR2xvYmFsOiBGaW5kR2xvYmFsID0gYXN5bmMgZnVuY3Rpb24gZmluZEdsb2JhbChcbiAgdGhpczogTW9uZ29vc2VBZGFwdGVyLFxuICB7IHNsdWcsIGxvY2FsZSwgcmVxID0ge30gYXMgUGF5bG9hZFJlcXVlc3QsIHdoZXJlIH0sXG4pIHtcbiAgY29uc3QgTW9kZWwgPSB0aGlzLmdsb2JhbHNcbiAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAuLi4oYXdhaXQgd2l0aFNlc3Npb24odGhpcywgcmVxKSksXG4gICAgbGVhbjogdHJ1ZSxcbiAgfVxuXG4gIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgTW9kZWwuYnVpbGRRdWVyeSh7XG4gICAgZ2xvYmFsU2x1Zzogc2x1ZyxcbiAgICBsb2NhbGUsXG4gICAgcGF5bG9hZDogdGhpcy5wYXlsb2FkLFxuICAgIHdoZXJlOiBjb21iaW5lUXVlcmllcyh7IGdsb2JhbFR5cGU6IHsgZXF1YWxzOiBzbHVnIH0gfSwgd2hlcmUpLFxuICB9KVxuXG4gIGxldCBkb2MgPSAoYXdhaXQgTW9kZWwuZmluZE9uZShxdWVyeSwge30sIG9wdGlvbnMpKSBhcyBhbnlcblxuICBpZiAoIWRvYykge1xuICAgIHJldHVybiBudWxsXG4gIH1cblxuICBpZiAodGhpcy5qc29uUGFyc2UpIHtcbiAgICBkb2MgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRvYykpXG4gIH1cblxuICBpZiAoZG9jLl9pZCkge1xuICAgIGRvYy5pZCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZG9jLl9pZCkpXG4gICAgZGVsZXRlIGRvYy5faWRcbiAgfVxuXG4gIGRvYyA9IHNhbml0aXplSW50ZXJuYWxGaWVsZHMoZG9jKVxuXG4gIHJldHVybiBkb2Ncbn1cbiJdLCJuYW1lcyI6WyJmaW5kR2xvYmFsIiwic2x1ZyIsImxvY2FsZSIsInJlcSIsIndoZXJlIiwiTW9kZWwiLCJnbG9iYWxzIiwib3B0aW9ucyIsIndpdGhTZXNzaW9uIiwibGVhbiIsInF1ZXJ5IiwiYnVpbGRRdWVyeSIsImdsb2JhbFNsdWciLCJwYXlsb2FkIiwiY29tYmluZVF1ZXJpZXMiLCJnbG9iYWxUeXBlIiwiZXF1YWxzIiwiZG9jIiwiZmluZE9uZSIsImpzb25QYXJzZSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsIl9pZCIsImlkIiwic2FuaXRpemVJbnRlcm5hbEZpZWxkcyJdLCJyYW5nZU1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzsiLCJtYXBwaW5ncyI6Ijs7OzsrQkFVYUE7OztlQUFBQTs7OzBCQVBrQjsrRUFJSTs2QkFDUDs7Ozs7O0FBRXJCLE1BQU1BLGFBQXlCLGVBQWVBLFdBRW5ELEVBQUVDLElBQUksRUFBRUMsTUFBTSxFQUFFQyxNQUFNLENBQUMsQ0FBbUIsRUFBRUMsS0FBSyxFQUFFO0lBRW5ELE1BQU1DLFFBQVEsSUFBSSxDQUFDQyxPQUFPO0lBQzFCLE1BQU1DLFVBQVU7UUFDZCxHQUFJLE1BQU1DLElBQUFBLHdCQUFXLEVBQUMsSUFBSSxFQUFFTCxJQUFJO1FBQ2hDTSxNQUFNO0lBQ1I7SUFFQSxNQUFNQyxRQUFRLE1BQU1MLE1BQU1NLFVBQVUsQ0FBQztRQUNuQ0MsWUFBWVg7UUFDWkM7UUFDQVcsU0FBUyxJQUFJLENBQUNBLE9BQU87UUFDckJULE9BQU9VLElBQUFBLHdCQUFjLEVBQUM7WUFBRUMsWUFBWTtnQkFBRUMsUUFBUWY7WUFBSztRQUFFLEdBQUdHO0lBQzFEO0lBRUEsSUFBSWEsTUFBTyxNQUFNWixNQUFNYSxPQUFPLENBQUNSLE9BQU8sQ0FBQyxHQUFHSDtJQUUxQyxJQUFJLENBQUNVLEtBQUs7UUFDUixPQUFPO0lBQ1Q7SUFFQSxJQUFJLElBQUksQ0FBQ0UsU0FBUyxFQUFFO1FBQ2xCRixNQUFNRyxLQUFLQyxLQUFLLENBQUNELEtBQUtFLFNBQVMsQ0FBQ0w7SUFDbEM7SUFFQSxJQUFJQSxJQUFJTSxHQUFHLEVBQUU7UUFDWE4sSUFBSU8sRUFBRSxHQUFHSixLQUFLQyxLQUFLLENBQUNELEtBQUtFLFNBQVMsQ0FBQ0wsSUFBSU0sR0FBRztRQUMxQyxPQUFPTixJQUFJTSxHQUFHO0lBQ2hCO0lBRUFOLE1BQU1RLElBQUFBLCtCQUFzQixFQUFDUjtJQUU3QixPQUFPQTtBQUNUIn0=