"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "mongooseAdapter", {
    enumerable: true,
    get: function() {
        return mongooseAdapter;
    }
});
const _fs = /*#__PURE__*/ _interop_require_default(require("fs"));
const _mongoose = /*#__PURE__*/ _interop_require_default(require("mongoose"));
const _path = /*#__PURE__*/ _interop_require_default(require("path"));
const _database = require("payload/database");
const _connect = require("./connect");
const _count = require("./count");
const _create = require("./create");
const _createGlobal = require("./createGlobal");
const _createGlobalVersion = require("./createGlobalVersion");
const _createMigration = require("./createMigration");
const _createVersion = require("./createVersion");
const _deleteMany = require("./deleteMany");
const _deleteOne = require("./deleteOne");
const _deleteVersions = require("./deleteVersions");
const _destroy = require("./destroy");
const _find = require("./find");
const _findGlobal = require("./findGlobal");
const _findGlobalVersions = require("./findGlobalVersions");
const _findOne = require("./findOne");
const _findVersions = require("./findVersions");
const _init = require("./init");
const _migrateFresh = require("./migrateFresh");
const _queryDrafts = require("./queryDrafts");
const _beginTransaction = require("./transactions/beginTransaction");
const _commitTransaction = require("./transactions/commitTransaction");
const _rollbackTransaction = require("./transactions/rollbackTransaction");
const _updateGlobal = require("./updateGlobal");
const _updateGlobalVersion = require("./updateGlobalVersion");
const _updateOne = require("./updateOne");
const _updateVersion = require("./updateVersion");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function mongooseAdapter({ autoPluralization = true, collections, connectOptions, disableIndexHints = false, globals, jsonParse = true, migrationDir: migrationDirArg, schemaOptions, transactionOptions = {}, url }) {
    function adapter({ payload }) {
        const migrationDir = findMigrationDir(migrationDirArg);
        _mongoose.default.set('strictQuery', false);
        return (0, _database.createDatabaseAdapter)({
            name: 'mongoose',
            // Mongoose-specific
            autoPluralization,
            collectionOptions: collections || {},
            collections: {},
            connectOptions: connectOptions || {},
            connection: undefined,
            count: _count.count,
            disableIndexHints,
            globals: undefined,
            globalsOptions: globals || {},
            jsonParse,
            mongoMemoryServer: undefined,
            schemaOptions: schemaOptions || {},
            sessions: {},
            transactionOptions: transactionOptions === false ? undefined : transactionOptions,
            url,
            versions: {},
            // DatabaseAdapter
            beginTransaction: transactionOptions ? _beginTransaction.beginTransaction : undefined,
            commitTransaction: _commitTransaction.commitTransaction,
            connect: _connect.connect,
            create: _create.create,
            createGlobal: _createGlobal.createGlobal,
            createGlobalVersion: _createGlobalVersion.createGlobalVersion,
            createMigration: _createMigration.createMigration,
            createVersion: _createVersion.createVersion,
            defaultIDType: 'text',
            deleteMany: _deleteMany.deleteMany,
            deleteOne: _deleteOne.deleteOne,
            deleteVersions: _deleteVersions.deleteVersions,
            destroy: _destroy.destroy,
            find: _find.find,
            findGlobal: _findGlobal.findGlobal,
            findGlobalVersions: _findGlobalVersions.findGlobalVersions,
            findOne: _findOne.findOne,
            findVersions: _findVersions.findVersions,
            init: _init.init,
            migrateFresh: _migrateFresh.migrateFresh,
            migrationDir,
            payload,
            queryDrafts: _queryDrafts.queryDrafts,
            rollbackTransaction: _rollbackTransaction.rollbackTransaction,
            updateGlobal: _updateGlobal.updateGlobal,
            updateGlobalVersion: _updateGlobalVersion.updateGlobalVersion,
            updateOne: _updateOne.updateOne,
            updateVersion: _updateVersion.updateVersion
        });
    }
    return adapter;
}
/**
 * Attempt to find migrations directory.
 *
 * Checks for the following directories in order:
 * - `migrationDir` argument from Payload config
 * - `src/migrations`
 * - `dist/migrations`
 * - `migrations`
 *
 * Defaults to `src/migrations`
 *
 * @param migrationDir
 * @returns
 */ function findMigrationDir(migrationDir) {
    const cwd = process.cwd();
    const srcDir = _path.default.resolve(cwd, 'src/migrations');
    const distDir = _path.default.resolve(cwd, 'dist/migrations');
    const relativeMigrations = _path.default.resolve(cwd, 'migrations');
    // Use arg if provided
    if (migrationDir) return migrationDir;
    // Check other common locations
    if (_fs.default.existsSync(srcDir)) {
        return srcDir;
    }
    if (_fs.default.existsSync(distDir)) {
        return distDir;
    }
    if (_fs.default.existsSync(relativeMigrations)) {
        return relativeMigrations;
    }
    return srcDir;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IENvbGxhdGlvbk9wdGlvbnMsIFRyYW5zYWN0aW9uT3B0aW9ucyB9IGZyb20gJ21vbmdvZGInXG5pbXBvcnQgdHlwZSB7IENsaWVudFNlc3Npb24sIENvbm5lY3RPcHRpb25zLCBDb25uZWN0aW9uLCBTY2hlbWFPcHRpb25zIH0gZnJvbSAnbW9uZ29vc2UnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWQgfSBmcm9tICdwYXlsb2FkJ1xuaW1wb3J0IHR5cGUgeyBCYXNlRGF0YWJhc2VBZGFwdGVyIH0gZnJvbSAncGF5bG9hZC9kYXRhYmFzZSdcblxuaW1wb3J0IGZzIGZyb20gJ2ZzJ1xuaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJ1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCdcbmltcG9ydCB7IGNyZWF0ZURhdGFiYXNlQWRhcHRlciB9IGZyb20gJ3BheWxvYWQvZGF0YWJhc2UnXG5cbmltcG9ydCB0eXBlIHsgQ29sbGVjdGlvbk1vZGVsLCBHbG9iYWxNb2RlbCB9IGZyb20gJy4vdHlwZXMnXG5cbmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICcuL2Nvbm5lY3QnXG5pbXBvcnQgeyBjb3VudCB9IGZyb20gJy4vY291bnQnXG5pbXBvcnQgeyBjcmVhdGUgfSBmcm9tICcuL2NyZWF0ZSdcbmltcG9ydCB7IGNyZWF0ZUdsb2JhbCB9IGZyb20gJy4vY3JlYXRlR2xvYmFsJ1xuaW1wb3J0IHsgY3JlYXRlR2xvYmFsVmVyc2lvbiB9IGZyb20gJy4vY3JlYXRlR2xvYmFsVmVyc2lvbidcbmltcG9ydCB7IGNyZWF0ZU1pZ3JhdGlvbiB9IGZyb20gJy4vY3JlYXRlTWlncmF0aW9uJ1xuaW1wb3J0IHsgY3JlYXRlVmVyc2lvbiB9IGZyb20gJy4vY3JlYXRlVmVyc2lvbidcbmltcG9ydCB7IGRlbGV0ZU1hbnkgfSBmcm9tICcuL2RlbGV0ZU1hbnknXG5pbXBvcnQgeyBkZWxldGVPbmUgfSBmcm9tICcuL2RlbGV0ZU9uZSdcbmltcG9ydCB7IGRlbGV0ZVZlcnNpb25zIH0gZnJvbSAnLi9kZWxldGVWZXJzaW9ucydcbmltcG9ydCB7IGRlc3Ryb3kgfSBmcm9tICcuL2Rlc3Ryb3knXG5pbXBvcnQgeyBmaW5kIH0gZnJvbSAnLi9maW5kJ1xuaW1wb3J0IHsgZmluZEdsb2JhbCB9IGZyb20gJy4vZmluZEdsb2JhbCdcbmltcG9ydCB7IGZpbmRHbG9iYWxWZXJzaW9ucyB9IGZyb20gJy4vZmluZEdsb2JhbFZlcnNpb25zJ1xuaW1wb3J0IHsgZmluZE9uZSB9IGZyb20gJy4vZmluZE9uZSdcbmltcG9ydCB7IGZpbmRWZXJzaW9ucyB9IGZyb20gJy4vZmluZFZlcnNpb25zJ1xuaW1wb3J0IHsgaW5pdCB9IGZyb20gJy4vaW5pdCdcbmltcG9ydCB7IG1pZ3JhdGVGcmVzaCB9IGZyb20gJy4vbWlncmF0ZUZyZXNoJ1xuaW1wb3J0IHsgcXVlcnlEcmFmdHMgfSBmcm9tICcuL3F1ZXJ5RHJhZnRzJ1xuaW1wb3J0IHsgYmVnaW5UcmFuc2FjdGlvbiB9IGZyb20gJy4vdHJhbnNhY3Rpb25zL2JlZ2luVHJhbnNhY3Rpb24nXG5pbXBvcnQgeyBjb21taXRUcmFuc2FjdGlvbiB9IGZyb20gJy4vdHJhbnNhY3Rpb25zL2NvbW1pdFRyYW5zYWN0aW9uJ1xuaW1wb3J0IHsgcm9sbGJhY2tUcmFuc2FjdGlvbiB9IGZyb20gJy4vdHJhbnNhY3Rpb25zL3JvbGxiYWNrVHJhbnNhY3Rpb24nXG5pbXBvcnQgeyB1cGRhdGVHbG9iYWwgfSBmcm9tICcuL3VwZGF0ZUdsb2JhbCdcbmltcG9ydCB7IHVwZGF0ZUdsb2JhbFZlcnNpb24gfSBmcm9tICcuL3VwZGF0ZUdsb2JhbFZlcnNpb24nXG5pbXBvcnQgeyB1cGRhdGVPbmUgfSBmcm9tICcuL3VwZGF0ZU9uZSdcbmltcG9ydCB7IHVwZGF0ZVZlcnNpb24gfSBmcm9tICcuL3VwZGF0ZVZlcnNpb24nXG5cbmV4cG9ydCB0eXBlIHsgTWlncmF0ZURvd25BcmdzLCBNaWdyYXRlVXBBcmdzIH0gZnJvbSAnLi90eXBlcydcblxuZXhwb3J0IGludGVyZmFjZSBBcmdzIHtcbiAgLyoqIFNldCB0byBmYWxzZSB0byBkaXNhYmxlIGF1dG8tcGx1cmFsaXphdGlvbiBvZiBjb2xsZWN0aW9uIG5hbWVzLCBEZWZhdWx0cyB0byB0cnVlICovXG4gIGF1dG9QbHVyYWxpemF0aW9uPzogYm9vbGVhblxuICAvKipcbiAgICogSWYgZW5hYmxlZCwgY29sbGF0aW9uIGFsbG93cyBmb3IgbGFuZ3VhZ2Utc3BlY2lmaWMgcnVsZXMgZm9yIHN0cmluZyBjb21wYXJpc29uLlxuICAgKiBUaGlzIGNvbmZpZ3VyYXRpb24gY2FuIGluY2x1ZGUgdGhlIGZvbGxvd2luZyBvcHRpb25zOlxuICAgKlxuICAgKiAtIGBzdHJlbmd0aGAgKG51bWJlcik6IENvbXBhcmlzb24gbGV2ZWwgKDE6IFByaW1hcnksIDI6IFNlY29uZGFyeSwgMzogVGVydGlhcnkgKGRlZmF1bHQpLCA0OiBRdWF0ZXJuYXJ5LCA1OiBJZGVudGljYWwpXG4gICAqIC0gYGNhc2VMZXZlbGAgKGJvb2xlYW4pOiBJbmNsdWRlIGNhc2UgY29tcGFyaXNvbiBhdCBzdHJlbmd0aCBsZXZlbCAxIG9yIDIuXG4gICAqIC0gYGNhc2VGaXJzdGAgKHN0cmluZyk6IFNvcnQgb3JkZXIgb2YgY2FzZSBkaWZmZXJlbmNlcyBkdXJpbmcgdGVydGlhcnkgbGV2ZWwgY29tcGFyaXNvbnMgKFwidXBwZXJcIiwgXCJsb3dlclwiLCBcIm9mZlwiKS5cbiAgICogLSBgbnVtZXJpY09yZGVyaW5nYCAoYm9vbGVhbik6IENvbXBhcmUgbnVtZXJpYyBzdHJpbmdzIGFzIG51bWJlcnMuXG4gICAqIC0gYGFsdGVybmF0ZWAgKHN0cmluZyk6IENvbnNpZGVyIHdoaXRlc3BhY2UgYW5kIHB1bmN0dWF0aW9uIGFzIGJhc2UgY2hhcmFjdGVycyAoXCJub24taWdub3JhYmxlXCIsIFwic2hpZnRlZFwiKS5cbiAgICogLSBgbWF4VmFyaWFibGVgIChzdHJpbmcpOiBDaGFyYWN0ZXJzIGNvbnNpZGVyZWQgaWdub3JhYmxlIHdoZW4gYGFsdGVybmF0ZWAgaXMgXCJzaGlmdGVkXCIgKFwicHVuY3RcIiwgXCJzcGFjZVwiKS5cbiAgICogLSBgYmFja3dhcmRzYCAoYm9vbGVhbik6IFNvcnQgc3RyaW5ncyB3aXRoIGRpYWNyaXRpY3MgZnJvbSBiYWNrIG9mIHRoZSBzdHJpbmcuXG4gICAqIC0gYG5vcm1hbGl6YXRpb25gIChib29sZWFuKTogQ2hlY2sgaWYgdGV4dCByZXF1aXJlcyBub3JtYWxpemF0aW9uIGFuZCBwZXJmb3JtIG5vcm1hbGl6YXRpb24uXG4gICAqXG4gICAqIEF2YWlsYWJsZSBvbiBNb25nb0RCIHZlcnNpb24gMy40IGFuZCB1cC5cbiAgICogVGhlIGxvY2FsZSB0aGF0IGdldHMgcGFzc2VkIGlzIHlvdXIgY3VycmVudCBwcm9qZWN0J3MgbG9jYWxlIGJ1dCBkZWZhdWx0cyB0byBcImVuXCIuXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqIHtcbiAgICogICBzdHJlbmd0aDogM1xuICAgKiB9XG4gICAqXG4gICAqIERlZmF1bHRzIHRvIGRpc2FibGVkLlxuICAgKi9cbiAgY29sbGF0aW9uPzogT21pdDxDb2xsYXRpb25PcHRpb25zLCAnbG9jYWxlJz5cbiAgLyoqIERlZmluZSBNb25nb29zZSBvcHRpb25zIG9uIGEgY29sbGVjdGlvbi1ieS1jb2xsZWN0aW9uIGJhc2lzLlxuICAgKi9cbiAgY29sbGVjdGlvbnM/OiB7XG4gICAgW3NsdWc6IHN0cmluZ106IHtcbiAgICAgIC8qKiBEZWZpbmUgTW9uZ29vc2Ugc2NoZW1hIG9wdGlvbnMgZm9yIGEgZ2l2ZW4gY29sbGVjdGlvbi5cbiAgICAgICAqL1xuICAgICAgc2NoZW1hT3B0aW9ucz86IFNjaGVtYU9wdGlvbnNcbiAgICB9XG4gIH1cbiAgLyoqIEV4dHJhIGNvbmZpZ3VyYXRpb24gb3B0aW9ucyAqL1xuICBjb25uZWN0T3B0aW9ucz86IENvbm5lY3RPcHRpb25zICYge1xuICAgIC8qKiBTZXQgZmFsc2UgdG8gZGlzYWJsZSAkZmFjZXQgYWdncmVnYXRpb24gaW4gbm9uLXN1cHBvcnRpbmcgZGF0YWJhc2VzLCBEZWZhdWx0cyB0byB0cnVlICovXG4gICAgdXNlRmFjZXQ/OiBib29sZWFuXG4gIH1cblxuICAvKiogU2V0IHRvIHRydWUgdG8gZGlzYWJsZSBoaW50aW5nIHRvIE1vbmdvREIgdG8gdXNlICdpZCcgYXMgaW5kZXguIFRoaXMgaXMgY3VycmVudGx5IGRvbmUgd2hlbiBjb3VudGluZyBkb2N1bWVudHMgZm9yIHBhZ2luYXRpb24uIERpc2FibGluZyB0aGlzIG9wdGltaXphdGlvbiBtaWdodCBmaXggc29tZSBwcm9ibGVtcyB3aXRoIEFXUyBEb2N1bWVudERCLiBEZWZhdWx0cyB0byBmYWxzZSAqL1xuICBkaXNhYmxlSW5kZXhIaW50cz86IGJvb2xlYW5cbiAgLyoqIERlZmluZSBNb25nb29zZSBvcHRpb25zIGZvciB0aGUgZ2xvYmFscyBjb2xsZWN0aW9uLlxuICAgKi9cbiAgZ2xvYmFscz86IHtcbiAgICBzY2hlbWFPcHRpb25zPzogU2NoZW1hT3B0aW9uc1xuICB9XG4gIC8qKiBTZXQgdG8gZmFsc2UgdG8gZGlzYWJsZSB0aGUgYXV0b21hdGljIEpTT04gc3RyaW5naWZ5L3BhcnNlIG9mIGRhdGEgcXVlcmllZCBieSBNb25nb0RCLiBGb3IgZXhhbXBsZSwgaWYgeW91IGhhdmUgZGF0YSBub3QgdHJhY2tlZCBieSBQYXlsb2FkIHN1Y2ggYXMgYERhdGVgIGZpZWxkcyBhbmQgc2ltaWxhciwgeW91IGNhbiB1c2UgdGhpcyBvcHRpb24gdG8gZW5zdXJlIHRoYXQgZXhpc3RpbmcgYERhdGVgIHByb3BlcnRpZXMgcmVtYWluIGFzIGBEYXRlYCBhbmQgbm90IHN0cmluZ3MuICovXG4gIGpzb25QYXJzZT86IGJvb2xlYW5cbiAgbWlncmF0aW9uRGlyPzogc3RyaW5nXG4gIC8qKiBEZWZpbmUgZGVmYXVsdCBNb25nb29zZSBzY2hlbWEgb3B0aW9ucyBmb3IgYWxsIHNjaGVtYXMgY3JlYXRlZC5cbiAgICovXG4gIHNjaGVtYU9wdGlvbnM/OiBTY2hlbWFPcHRpb25zXG4gIHRyYW5zYWN0aW9uT3B0aW9ucz86IFRyYW5zYWN0aW9uT3B0aW9ucyB8IGZhbHNlXG4gIC8qKiBUaGUgVVJMIHRvIGNvbm5lY3QgdG8gTW9uZ29EQiBvciBmYWxzZSB0byBzdGFydCBwYXlsb2FkIGFuZCBwcmV2ZW50IGNvbm5lY3RpbmcgKi9cbiAgdXJsOiBmYWxzZSB8IHN0cmluZ1xufVxuXG5leHBvcnQgdHlwZSBNb25nb29zZUFkYXB0ZXIgPSBCYXNlRGF0YWJhc2VBZGFwdGVyICZcbiAgQXJncyAmIHtcbiAgICBjb2xsZWN0aW9uT3B0aW9uczoge1xuICAgICAgW3NsdWc6IHN0cmluZ106IHtcbiAgICAgICAgc2NoZW1hT3B0aW9ucz86IFNjaGVtYU9wdGlvbnNcbiAgICAgIH1cbiAgICB9XG4gICAgY29sbGVjdGlvbnM6IHtcbiAgICAgIFtzbHVnOiBzdHJpbmddOiBDb2xsZWN0aW9uTW9kZWxcbiAgICB9XG4gICAgY29ubmVjdGlvbjogQ29ubmVjdGlvblxuICAgIGdsb2JhbHM6IEdsb2JhbE1vZGVsXG4gICAgZ2xvYmFsc09wdGlvbnM6IHtcbiAgICAgIHNjaGVtYU9wdGlvbnM/OiBTY2hlbWFPcHRpb25zXG4gICAgfVxuICAgIGpzb25QYXJzZTogYm9vbGVhblxuICAgIG1vbmdvTWVtb3J5U2VydmVyOiBhbnlcbiAgICBzY2hlbWFPcHRpb25zPzogU2NoZW1hT3B0aW9uc1xuICAgIHNlc3Npb25zOiBSZWNvcmQ8bnVtYmVyIHwgc3RyaW5nLCBDbGllbnRTZXNzaW9uPlxuICAgIHZlcnNpb25zOiB7XG4gICAgICBbc2x1Zzogc3RyaW5nXTogQ29sbGVjdGlvbk1vZGVsXG4gICAgfVxuICB9XG5cbnR5cGUgTW9uZ29vc2VBZGFwdGVyUmVzdWx0ID0gKGFyZ3M6IHsgcGF5bG9hZDogUGF5bG9hZCB9KSA9PiBNb25nb29zZUFkYXB0ZXJcblxuZGVjbGFyZSBtb2R1bGUgJ3BheWxvYWQnIHtcbiAgZXhwb3J0IGludGVyZmFjZSBEYXRhYmFzZUFkYXB0ZXJcbiAgICBleHRlbmRzIE9taXQ8QmFzZURhdGFiYXNlQWRhcHRlciwgJ3Nlc3Npb25zJz4sXG4gICAgICBPbWl0PEFyZ3MsICdjb2xsZWN0aW9ucycgfCAnZ2xvYmFscycgfCAnbWlncmF0aW9uRGlyJz4ge1xuICAgIGNvbGxlY3Rpb25PcHRpb25zOiB7XG4gICAgICBbc2x1Zzogc3RyaW5nXToge1xuICAgICAgICBzY2hlbWFPcHRpb25zPzogU2NoZW1hT3B0aW9uc1xuICAgICAgfVxuICAgIH1cbiAgICBjb2xsZWN0aW9uczoge1xuICAgICAgW3NsdWc6IHN0cmluZ106IENvbGxlY3Rpb25Nb2RlbFxuICAgIH1cbiAgICBjb25uZWN0aW9uOiBDb25uZWN0aW9uXG4gICAgZ2xvYmFsczogR2xvYmFsTW9kZWxcbiAgICBnbG9iYWxzT3B0aW9uczoge1xuICAgICAgc2NoZW1hT3B0aW9ucz86IFNjaGVtYU9wdGlvbnNcbiAgICB9XG4gICAganNvblBhcnNlOiBib29sZWFuXG4gICAgbW9uZ29NZW1vcnlTZXJ2ZXI6IGFueVxuICAgIHNjaGVtYU9wdGlvbnM/OiBTY2hlbWFPcHRpb25zXG5cbiAgICBzZXNzaW9uczogUmVjb3JkPG51bWJlciB8IHN0cmluZywgQ2xpZW50U2Vzc2lvbj5cbiAgICB0cmFuc2FjdGlvbk9wdGlvbnM6IFRyYW5zYWN0aW9uT3B0aW9uc1xuICAgIHZlcnNpb25zOiB7XG4gICAgICBbc2x1Zzogc3RyaW5nXTogQ29sbGVjdGlvbk1vZGVsXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtb25nb29zZUFkYXB0ZXIoe1xuICBhdXRvUGx1cmFsaXphdGlvbiA9IHRydWUsXG4gIGNvbGxlY3Rpb25zLFxuICBjb25uZWN0T3B0aW9ucyxcbiAgZGlzYWJsZUluZGV4SGludHMgPSBmYWxzZSxcbiAgZ2xvYmFscyxcbiAganNvblBhcnNlID0gdHJ1ZSxcbiAgbWlncmF0aW9uRGlyOiBtaWdyYXRpb25EaXJBcmcsXG4gIHNjaGVtYU9wdGlvbnMsXG4gIHRyYW5zYWN0aW9uT3B0aW9ucyA9IHt9LFxuICB1cmwsXG59OiBBcmdzKTogTW9uZ29vc2VBZGFwdGVyUmVzdWx0IHtcbiAgZnVuY3Rpb24gYWRhcHRlcih7IHBheWxvYWQgfTogeyBwYXlsb2FkOiBQYXlsb2FkIH0pIHtcbiAgICBjb25zdCBtaWdyYXRpb25EaXIgPSBmaW5kTWlncmF0aW9uRGlyKG1pZ3JhdGlvbkRpckFyZylcbiAgICBtb25nb29zZS5zZXQoJ3N0cmljdFF1ZXJ5JywgZmFsc2UpXG5cbiAgICByZXR1cm4gY3JlYXRlRGF0YWJhc2VBZGFwdGVyPE1vbmdvb3NlQWRhcHRlcj4oe1xuICAgICAgbmFtZTogJ21vbmdvb3NlJyxcblxuICAgICAgLy8gTW9uZ29vc2Utc3BlY2lmaWNcbiAgICAgIGF1dG9QbHVyYWxpemF0aW9uLFxuICAgICAgY29sbGVjdGlvbk9wdGlvbnM6IGNvbGxlY3Rpb25zIHx8IHt9LFxuICAgICAgY29sbGVjdGlvbnM6IHt9LFxuICAgICAgY29ubmVjdE9wdGlvbnM6IGNvbm5lY3RPcHRpb25zIHx8IHt9LFxuICAgICAgY29ubmVjdGlvbjogdW5kZWZpbmVkLFxuICAgICAgY291bnQsXG4gICAgICBkaXNhYmxlSW5kZXhIaW50cyxcbiAgICAgIGdsb2JhbHM6IHVuZGVmaW5lZCxcbiAgICAgIGdsb2JhbHNPcHRpb25zOiBnbG9iYWxzIHx8IHt9LFxuICAgICAganNvblBhcnNlLFxuICAgICAgbW9uZ29NZW1vcnlTZXJ2ZXI6IHVuZGVmaW5lZCxcbiAgICAgIHNjaGVtYU9wdGlvbnM6IHNjaGVtYU9wdGlvbnMgfHwge30sXG4gICAgICBzZXNzaW9uczoge30sXG4gICAgICB0cmFuc2FjdGlvbk9wdGlvbnM6IHRyYW5zYWN0aW9uT3B0aW9ucyA9PT0gZmFsc2UgPyB1bmRlZmluZWQgOiB0cmFuc2FjdGlvbk9wdGlvbnMsXG4gICAgICB1cmwsXG4gICAgICB2ZXJzaW9uczoge30sXG5cbiAgICAgIC8vIERhdGFiYXNlQWRhcHRlclxuICAgICAgYmVnaW5UcmFuc2FjdGlvbjogdHJhbnNhY3Rpb25PcHRpb25zID8gYmVnaW5UcmFuc2FjdGlvbiA6IHVuZGVmaW5lZCxcbiAgICAgIGNvbW1pdFRyYW5zYWN0aW9uLFxuICAgICAgY29ubmVjdCxcbiAgICAgIGNyZWF0ZSxcbiAgICAgIGNyZWF0ZUdsb2JhbCxcbiAgICAgIGNyZWF0ZUdsb2JhbFZlcnNpb24sXG4gICAgICBjcmVhdGVNaWdyYXRpb24sXG4gICAgICBjcmVhdGVWZXJzaW9uLFxuICAgICAgZGVmYXVsdElEVHlwZTogJ3RleHQnLFxuICAgICAgZGVsZXRlTWFueSxcbiAgICAgIGRlbGV0ZU9uZSxcbiAgICAgIGRlbGV0ZVZlcnNpb25zLFxuICAgICAgZGVzdHJveSxcbiAgICAgIGZpbmQsXG4gICAgICBmaW5kR2xvYmFsLFxuICAgICAgZmluZEdsb2JhbFZlcnNpb25zLFxuICAgICAgZmluZE9uZSxcbiAgICAgIGZpbmRWZXJzaW9ucyxcbiAgICAgIGluaXQsXG4gICAgICBtaWdyYXRlRnJlc2gsXG4gICAgICBtaWdyYXRpb25EaXIsXG4gICAgICBwYXlsb2FkLFxuICAgICAgcXVlcnlEcmFmdHMsXG4gICAgICByb2xsYmFja1RyYW5zYWN0aW9uLFxuICAgICAgdXBkYXRlR2xvYmFsLFxuICAgICAgdXBkYXRlR2xvYmFsVmVyc2lvbixcbiAgICAgIHVwZGF0ZU9uZSxcbiAgICAgIHVwZGF0ZVZlcnNpb24sXG4gICAgfSlcbiAgfVxuXG4gIHJldHVybiBhZGFwdGVyXG59XG5cbi8qKlxuICogQXR0ZW1wdCB0byBmaW5kIG1pZ3JhdGlvbnMgZGlyZWN0b3J5LlxuICpcbiAqIENoZWNrcyBmb3IgdGhlIGZvbGxvd2luZyBkaXJlY3RvcmllcyBpbiBvcmRlcjpcbiAqIC0gYG1pZ3JhdGlvbkRpcmAgYXJndW1lbnQgZnJvbSBQYXlsb2FkIGNvbmZpZ1xuICogLSBgc3JjL21pZ3JhdGlvbnNgXG4gKiAtIGBkaXN0L21pZ3JhdGlvbnNgXG4gKiAtIGBtaWdyYXRpb25zYFxuICpcbiAqIERlZmF1bHRzIHRvIGBzcmMvbWlncmF0aW9uc2BcbiAqXG4gKiBAcGFyYW0gbWlncmF0aW9uRGlyXG4gKiBAcmV0dXJuc1xuICovXG5mdW5jdGlvbiBmaW5kTWlncmF0aW9uRGlyKG1pZ3JhdGlvbkRpcj86IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IGN3ZCA9IHByb2Nlc3MuY3dkKClcbiAgY29uc3Qgc3JjRGlyID0gcGF0aC5yZXNvbHZlKGN3ZCwgJ3NyYy9taWdyYXRpb25zJylcbiAgY29uc3QgZGlzdERpciA9IHBhdGgucmVzb2x2ZShjd2QsICdkaXN0L21pZ3JhdGlvbnMnKVxuICBjb25zdCByZWxhdGl2ZU1pZ3JhdGlvbnMgPSBwYXRoLnJlc29sdmUoY3dkLCAnbWlncmF0aW9ucycpXG5cbiAgLy8gVXNlIGFyZyBpZiBwcm92aWRlZFxuICBpZiAobWlncmF0aW9uRGlyKSByZXR1cm4gbWlncmF0aW9uRGlyXG5cbiAgLy8gQ2hlY2sgb3RoZXIgY29tbW9uIGxvY2F0aW9uc1xuICBpZiAoZnMuZXhpc3RzU3luYyhzcmNEaXIpKSB7XG4gICAgcmV0dXJuIHNyY0RpclxuICB9XG5cbiAgaWYgKGZzLmV4aXN0c1N5bmMoZGlzdERpcikpIHtcbiAgICByZXR1cm4gZGlzdERpclxuICB9XG5cbiAgaWYgKGZzLmV4aXN0c1N5bmMocmVsYXRpdmVNaWdyYXRpb25zKSkge1xuICAgIHJldHVybiByZWxhdGl2ZU1pZ3JhdGlvbnNcbiAgfVxuXG4gIHJldHVybiBzcmNEaXJcbn1cbiJdLCJuYW1lcyI6WyJtb25nb29zZUFkYXB0ZXIiLCJhdXRvUGx1cmFsaXphdGlvbiIsImNvbGxlY3Rpb25zIiwiY29ubmVjdE9wdGlvbnMiLCJkaXNhYmxlSW5kZXhIaW50cyIsImdsb2JhbHMiLCJqc29uUGFyc2UiLCJtaWdyYXRpb25EaXIiLCJtaWdyYXRpb25EaXJBcmciLCJzY2hlbWFPcHRpb25zIiwidHJhbnNhY3Rpb25PcHRpb25zIiwidXJsIiwiYWRhcHRlciIsInBheWxvYWQiLCJmaW5kTWlncmF0aW9uRGlyIiwibW9uZ29vc2UiLCJzZXQiLCJjcmVhdGVEYXRhYmFzZUFkYXB0ZXIiLCJuYW1lIiwiY29sbGVjdGlvbk9wdGlvbnMiLCJjb25uZWN0aW9uIiwidW5kZWZpbmVkIiwiY291bnQiLCJnbG9iYWxzT3B0aW9ucyIsIm1vbmdvTWVtb3J5U2VydmVyIiwic2Vzc2lvbnMiLCJ2ZXJzaW9ucyIsImJlZ2luVHJhbnNhY3Rpb24iLCJjb21taXRUcmFuc2FjdGlvbiIsImNvbm5lY3QiLCJjcmVhdGUiLCJjcmVhdGVHbG9iYWwiLCJjcmVhdGVHbG9iYWxWZXJzaW9uIiwiY3JlYXRlTWlncmF0aW9uIiwiY3JlYXRlVmVyc2lvbiIsImRlZmF1bHRJRFR5cGUiLCJkZWxldGVNYW55IiwiZGVsZXRlT25lIiwiZGVsZXRlVmVyc2lvbnMiLCJkZXN0cm95IiwiZmluZCIsImZpbmRHbG9iYWwiLCJmaW5kR2xvYmFsVmVyc2lvbnMiLCJmaW5kT25lIiwiZmluZFZlcnNpb25zIiwiaW5pdCIsIm1pZ3JhdGVGcmVzaCIsInF1ZXJ5RHJhZnRzIiwicm9sbGJhY2tUcmFuc2FjdGlvbiIsInVwZGF0ZUdsb2JhbCIsInVwZGF0ZUdsb2JhbFZlcnNpb24iLCJ1cGRhdGVPbmUiLCJ1cGRhdGVWZXJzaW9uIiwiY3dkIiwicHJvY2VzcyIsInNyY0RpciIsInBhdGgiLCJyZXNvbHZlIiwiZGlzdERpciIsInJlbGF0aXZlTWlncmF0aW9ucyIsImZzIiwiZXhpc3RzU3luYyJdLCJyYW5nZU1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7IiwibWFwcGluZ3MiOiI7Ozs7K0JBNEpnQkE7OztlQUFBQTs7OzJEQXZKRDtpRUFDTTs2REFDSjswQkFDcUI7eUJBSWQ7dUJBQ0Y7d0JBQ0M7OEJBQ007cUNBQ087aUNBQ0o7K0JBQ0Y7NEJBQ0g7MkJBQ0Q7Z0NBQ0s7eUJBQ1A7c0JBQ0g7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