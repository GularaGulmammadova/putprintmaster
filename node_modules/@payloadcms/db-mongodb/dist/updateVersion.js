"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "updateVersion", {
    enumerable: true,
    get: function() {
        return updateVersion;
    }
});
const _sanitizeInternalFields = /*#__PURE__*/ _interop_require_default(require("./utilities/sanitizeInternalFields"));
const _withSession = require("./withSession");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
const updateVersion = async function updateVersion({ id, collection, locale, req = {}, versionData, where }) {
    const VersionModel = this.versions[collection];
    const whereToUse = where || {
        id: {
            equals: id
        }
    };
    const options = {
        ...await (0, _withSession.withSession)(this, req),
        lean: true,
        new: true
    };
    const query = await VersionModel.buildQuery({
        locale,
        payload: this.payload,
        where: whereToUse
    });
    let doc = await VersionModel.findOneAndUpdate(query, versionData, options);
    const verificationToken = doc._verificationToken;
    doc = this.jsonParse ? JSON.parse(JSON.stringify(doc)) : doc;
    if (verificationToken) {
        doc._verificationToken = verificationToken;
    }
    return (0, _sanitizeInternalFields.default)(doc);
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91cGRhdGVWZXJzaW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgVXBkYXRlVmVyc2lvbiB9IGZyb20gJ3BheWxvYWQvZGF0YWJhc2UnXG5pbXBvcnQgdHlwZSB7IFBheWxvYWRSZXF1ZXN0IH0gZnJvbSAncGF5bG9hZC90eXBlcydcblxuaW1wb3J0IHR5cGUgeyBNb25nb29zZUFkYXB0ZXIgfSBmcm9tICcuJ1xuXG5pbXBvcnQgc2FuaXRpemVJbnRlcm5hbEZpZWxkcyBmcm9tICcuL3V0aWxpdGllcy9zYW5pdGl6ZUludGVybmFsRmllbGRzJ1xuaW1wb3J0IHsgd2l0aFNlc3Npb24gfSBmcm9tICcuL3dpdGhTZXNzaW9uJ1xuXG5leHBvcnQgY29uc3QgdXBkYXRlVmVyc2lvbjogVXBkYXRlVmVyc2lvbiA9IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVZlcnNpb24oXG4gIHRoaXM6IE1vbmdvb3NlQWRhcHRlcixcbiAgeyBpZCwgY29sbGVjdGlvbiwgbG9jYWxlLCByZXEgPSB7fSBhcyBQYXlsb2FkUmVxdWVzdCwgdmVyc2lvbkRhdGEsIHdoZXJlIH0sXG4pIHtcbiAgY29uc3QgVmVyc2lvbk1vZGVsID0gdGhpcy52ZXJzaW9uc1tjb2xsZWN0aW9uXVxuICBjb25zdCB3aGVyZVRvVXNlID0gd2hlcmUgfHwgeyBpZDogeyBlcXVhbHM6IGlkIH0gfVxuICBjb25zdCBvcHRpb25zID0ge1xuICAgIC4uLihhd2FpdCB3aXRoU2Vzc2lvbih0aGlzLCByZXEpKSxcbiAgICBsZWFuOiB0cnVlLFxuICAgIG5ldzogdHJ1ZSxcbiAgfVxuXG4gIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgVmVyc2lvbk1vZGVsLmJ1aWxkUXVlcnkoe1xuICAgIGxvY2FsZSxcbiAgICBwYXlsb2FkOiB0aGlzLnBheWxvYWQsXG4gICAgd2hlcmU6IHdoZXJlVG9Vc2UsXG4gIH0pXG5cbiAgbGV0IGRvYyA9IGF3YWl0IFZlcnNpb25Nb2RlbC5maW5kT25lQW5kVXBkYXRlKHF1ZXJ5LCB2ZXJzaW9uRGF0YSwgb3B0aW9ucylcblxuICBjb25zdCB2ZXJpZmljYXRpb25Ub2tlbiA9IGRvYy5fdmVyaWZpY2F0aW9uVG9rZW5cblxuICBkb2MgPSB0aGlzLmpzb25QYXJzZSA/IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZG9jKSkgOiBkb2NcblxuICBpZiAodmVyaWZpY2F0aW9uVG9rZW4pIHtcbiAgICBkb2MuX3ZlcmlmaWNhdGlvblRva2VuID0gdmVyaWZpY2F0aW9uVG9rZW5cbiAgfVxuICByZXR1cm4gc2FuaXRpemVJbnRlcm5hbEZpZWxkcyhkb2MpXG59XG4iXSwibmFtZXMiOlsidXBkYXRlVmVyc2lvbiIsImlkIiwiY29sbGVjdGlvbiIsImxvY2FsZSIsInJlcSIsInZlcnNpb25EYXRhIiwid2hlcmUiLCJWZXJzaW9uTW9kZWwiLCJ2ZXJzaW9ucyIsIndoZXJlVG9Vc2UiLCJlcXVhbHMiLCJvcHRpb25zIiwid2l0aFNlc3Npb24iLCJsZWFuIiwibmV3IiwicXVlcnkiLCJidWlsZFF1ZXJ5IiwicGF5bG9hZCIsImRvYyIsImZpbmRPbmVBbmRVcGRhdGUiLCJ2ZXJpZmljYXRpb25Ub2tlbiIsIl92ZXJpZmljYXRpb25Ub2tlbiIsImpzb25QYXJzZSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsInNhbml0aXplSW50ZXJuYWxGaWVsZHMiXSwicmFuZ2VNYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7IiwibWFwcGluZ3MiOiI7Ozs7K0JBUWFBOzs7ZUFBQUE7OzsrRUFIc0I7NkJBQ1A7Ozs7OztBQUVyQixNQUFNQSxnQkFBK0IsZUFBZUEsY0FFekQsRUFBRUMsRUFBRSxFQUFFQyxVQUFVLEVBQUVDLE1BQU0sRUFBRUMsTUFBTSxDQUFDLENBQW1CLEVBQUVDLFdBQVcsRUFBRUMsS0FBSyxFQUFFO0lBRTFFLE1BQU1DLGVBQWUsSUFBSSxDQUFDQyxRQUFRLENBQUNOLFdBQVc7SUFDOUMsTUFBTU8sYUFBYUgsU0FBUztRQUFFTCxJQUFJO1lBQUVTLFFBQVFUO1FBQUc7SUFBRTtJQUNqRCxNQUFNVSxVQUFVO1FBQ2QsR0FBSSxNQUFNQyxJQUFBQSx3QkFBVyxFQUFDLElBQUksRUFBRVIsSUFBSTtRQUNoQ1MsTUFBTTtRQUNOQyxLQUFLO0lBQ1A7SUFFQSxNQUFNQyxRQUFRLE1BQU1SLGFBQWFTLFVBQVUsQ0FBQztRQUMxQ2I7UUFDQWMsU0FBUyxJQUFJLENBQUNBLE9BQU87UUFDckJYLE9BQU9HO0lBQ1Q7SUFFQSxJQUFJUyxNQUFNLE1BQU1YLGFBQWFZLGdCQUFnQixDQUFDSixPQUFPVixhQUFhTTtJQUVsRSxNQUFNUyxvQkFBb0JGLElBQUlHLGtCQUFrQjtJQUVoREgsTUFBTSxJQUFJLENBQUNJLFNBQVMsR0FBR0MsS0FBS0MsS0FBSyxDQUFDRCxLQUFLRSxTQUFTLENBQUNQLFFBQVFBO0lBRXpELElBQUlFLG1CQUFtQjtRQUNyQkYsSUFBSUcsa0JBQWtCLEdBQUdEO0lBQzNCO0lBQ0EsT0FBT00sSUFBQUEsK0JBQXNCLEVBQUNSO0FBQ2hDIn0=