"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "updateGlobalVersion", {
    enumerable: true,
    get: function() {
        return updateGlobalVersion;
    }
});
const _sanitizeInternalFields = /*#__PURE__*/ _interop_require_default(require("./utilities/sanitizeInternalFields"));
const _withSession = require("./withSession");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
async function updateGlobalVersion({ id, global, locale, req = {}, versionData, where }) {
    const VersionModel = this.versions[global];
    const whereToUse = where || {
        id: {
            equals: id
        }
    };
    const options = {
        ...await (0, _withSession.withSession)(this, req),
        lean: true,
        new: true
    };
    const query = await VersionModel.buildQuery({
        locale,
        payload: this.payload,
        where: whereToUse
    });
    let doc = await VersionModel.findOneAndUpdate(query, versionData, options);
    doc = this.jsonParse ? JSON.parse(JSON.stringify(doc)) : doc;
    const verificationToken = doc._verificationToken;
    if (verificationToken) {
        doc._verificationToken = verificationToken;
    }
    return (0, _sanitizeInternalFields.default)(doc);
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91cGRhdGVHbG9iYWxWZXJzaW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgVXBkYXRlR2xvYmFsVmVyc2lvbkFyZ3MgfSBmcm9tICdwYXlsb2FkL2RhdGFiYXNlJ1xuaW1wb3J0IHR5cGUgeyBQYXlsb2FkUmVxdWVzdCwgVHlwZVdpdGhJRCB9IGZyb20gJ3BheWxvYWQvdHlwZXMnXG5cbmltcG9ydCB0eXBlIHsgTW9uZ29vc2VBZGFwdGVyIH0gZnJvbSAnLidcblxuaW1wb3J0IHNhbml0aXplSW50ZXJuYWxGaWVsZHMgZnJvbSAnLi91dGlsaXRpZXMvc2FuaXRpemVJbnRlcm5hbEZpZWxkcydcbmltcG9ydCB7IHdpdGhTZXNzaW9uIH0gZnJvbSAnLi93aXRoU2Vzc2lvbidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUdsb2JhbFZlcnNpb248VCBleHRlbmRzIFR5cGVXaXRoSUQ+KFxuICB0aGlzOiBNb25nb29zZUFkYXB0ZXIsXG4gIHtcbiAgICBpZCxcbiAgICBnbG9iYWwsXG4gICAgbG9jYWxlLFxuICAgIHJlcSA9IHt9IGFzIFBheWxvYWRSZXF1ZXN0LFxuICAgIHZlcnNpb25EYXRhLFxuICAgIHdoZXJlLFxuICB9OiBVcGRhdGVHbG9iYWxWZXJzaW9uQXJnczxUPixcbikge1xuICBjb25zdCBWZXJzaW9uTW9kZWwgPSB0aGlzLnZlcnNpb25zW2dsb2JhbF1cbiAgY29uc3Qgd2hlcmVUb1VzZSA9IHdoZXJlIHx8IHsgaWQ6IHsgZXF1YWxzOiBpZCB9IH1cbiAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAuLi4oYXdhaXQgd2l0aFNlc3Npb24odGhpcywgcmVxKSksXG4gICAgbGVhbjogdHJ1ZSxcbiAgICBuZXc6IHRydWUsXG4gIH1cblxuICBjb25zdCBxdWVyeSA9IGF3YWl0IFZlcnNpb25Nb2RlbC5idWlsZFF1ZXJ5KHtcbiAgICBsb2NhbGUsXG4gICAgcGF5bG9hZDogdGhpcy5wYXlsb2FkLFxuICAgIHdoZXJlOiB3aGVyZVRvVXNlLFxuICB9KVxuXG4gIGxldCBkb2MgPSBhd2FpdCBWZXJzaW9uTW9kZWwuZmluZE9uZUFuZFVwZGF0ZShxdWVyeSwgdmVyc2lvbkRhdGEsIG9wdGlvbnMpXG5cbiAgZG9jID0gdGhpcy5qc29uUGFyc2UgPyBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRvYykpIDogZG9jXG5cbiAgY29uc3QgdmVyaWZpY2F0aW9uVG9rZW4gPSBkb2MuX3ZlcmlmaWNhdGlvblRva2VuXG5cbiAgaWYgKHZlcmlmaWNhdGlvblRva2VuKSB7XG4gICAgZG9jLl92ZXJpZmljYXRpb25Ub2tlbiA9IHZlcmlmaWNhdGlvblRva2VuXG4gIH1cbiAgcmV0dXJuIHNhbml0aXplSW50ZXJuYWxGaWVsZHMoZG9jKVxufVxuIl0sIm5hbWVzIjpbInVwZGF0ZUdsb2JhbFZlcnNpb24iLCJpZCIsImdsb2JhbCIsImxvY2FsZSIsInJlcSIsInZlcnNpb25EYXRhIiwid2hlcmUiLCJWZXJzaW9uTW9kZWwiLCJ2ZXJzaW9ucyIsIndoZXJlVG9Vc2UiLCJlcXVhbHMiLCJvcHRpb25zIiwid2l0aFNlc3Npb24iLCJsZWFuIiwibmV3IiwicXVlcnkiLCJidWlsZFF1ZXJ5IiwicGF5bG9hZCIsImRvYyIsImZpbmRPbmVBbmRVcGRhdGUiLCJqc29uUGFyc2UiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJ2ZXJpZmljYXRpb25Ub2tlbiIsIl92ZXJpZmljYXRpb25Ub2tlbiIsInNhbml0aXplSW50ZXJuYWxGaWVsZHMiXSwicmFuZ2VNYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7IiwibWFwcGluZ3MiOiI7Ozs7K0JBUXNCQTs7O2VBQUFBOzs7K0VBSGE7NkJBQ1A7Ozs7OztBQUVyQixlQUFlQSxvQkFFcEIsRUFDRUMsRUFBRSxFQUNGQyxNQUFNLEVBQ05DLE1BQU0sRUFDTkMsTUFBTSxDQUFDLENBQW1CLEVBQzFCQyxXQUFXLEVBQ1hDLEtBQUssRUFDc0I7SUFFN0IsTUFBTUMsZUFBZSxJQUFJLENBQUNDLFFBQVEsQ0FBQ04sT0FBTztJQUMxQyxNQUFNTyxhQUFhSCxTQUFTO1FBQUVMLElBQUk7WUFBRVMsUUFBUVQ7UUFBRztJQUFFO0lBQ2pELE1BQU1VLFVBQVU7UUFDZCxHQUFJLE1BQU1DLElBQUFBLHdCQUFXLEVBQUMsSUFBSSxFQUFFUixJQUFJO1FBQ2hDUyxNQUFNO1FBQ05DLEtBQUs7SUFDUDtJQUVBLE1BQU1DLFFBQVEsTUFBTVIsYUFBYVMsVUFBVSxDQUFDO1FBQzFDYjtRQUNBYyxTQUFTLElBQUksQ0FBQ0EsT0FBTztRQUNyQlgsT0FBT0c7SUFDVDtJQUVBLElBQUlTLE1BQU0sTUFBTVgsYUFBYVksZ0JBQWdCLENBQUNKLE9BQU9WLGFBQWFNO0lBRWxFTyxNQUFNLElBQUksQ0FBQ0UsU0FBUyxHQUFHQyxLQUFLQyxLQUFLLENBQUNELEtBQUtFLFNBQVMsQ0FBQ0wsUUFBUUE7SUFFekQsTUFBTU0sb0JBQW9CTixJQUFJTyxrQkFBa0I7SUFFaEQsSUFBSUQsbUJBQW1CO1FBQ3JCTixJQUFJTyxrQkFBa0IsR0FBR0Q7SUFDM0I7SUFDQSxPQUFPRSxJQUFBQSwrQkFBc0IsRUFBQ1I7QUFDaEMifQ==